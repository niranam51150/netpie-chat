<!DOCTYPE html>
<html>
<head>
	<title>NETPIE CHAT</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

	<!-- Include Fonts -->
	<link href='https://fonts.googleapis.com/css?family=Kanit:400,600&subset=thai,latin' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

	<!-- Include Style -->
	<link rel="stylesheet" href="css/material.css">
	<link rel="stylesheet" href="css/style.css">
	<script src="js/jquery.js"></script>
	<script src="js/material.js"></script>

	<!-- Include NETPIE -->
	<script src="js/microgear.js"></script>
</head>
<body id="main">
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
	<header class="mdl-layout__header">
		<div class="mdl-layout__header-row">
			<!-- Title -->
			<span class="mdl-layout-title">
				<img style="width: 50px;" src="https://netpie.io/wp-content/uploads/2015/07/netpie_mo-270x250.png">
				NETPIE CHAT
			</span>
		</div>
	</header>
	<div class="mdl-layout__drawer">
		<span class="mdl-layout-title"> <i class="material-icons" style="vertical-align: middle;">link</i> Link</span>
		<nav class="mdl-navigation">
			<a class="mdl-navigation__link" href="chat.html">Chat</a>
			<a class="mdl-navigation__link" href="https://github.com/niranam51150/netpie-chat">NetpieChat</a>
			<a class="mdl-navigation__link" href="https://github.com/netpieio">Netpie</a>
		</nav>
	</div>
	<main class="mdl-layout__content">
	<div class="page-content">
		<div class="mdl-grid">
			<div class="mdl-cell mdl-cell--4-col mdl-cell--2-col-tablet user-zone mdl-shadow--2dp">
				<div class="mdl-cell mdl-cell--12-col">
					<form>
						<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label center-block">
							<input id="name" class="mdl-textfield__input" type="text">
							<label class="mdl-textfield__label" >Name</label>
						</div>
					</form>
					<button id="connect" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored center-block">connect</button>
					
					<div class="usr-online"><div>User Online</div></div>
					<ul id="list-online" class="list-online mdl-list">
						<li class="mdl-list__item">
							<span class="mdl-list__item-primary-content">
								<i class="material-icons mdl-list__item-icon">person</i>
								Bryan Cranston
							</span>
						</li>
						<li class="mdl-list__item">
							<span class="mdl-list__item-primary-content">
								<i class="material-icons mdl-list__item-icon">person</i>
								Aaron Paul
							</span>
						</li>
						<li class="mdl-list__item">
							<span class="mdl-list__item-primary-content">
								<i class="material-icons mdl-list__item-icon">person</i>
								Bob Odenkirk
							</span>
						</li>
						<li class="mdl-list__item">
							<span class="mdl-list__item-primary-content">
								<i class="material-icons mdl-list__item-icon">person</i>
								Rorla Hahaha
							</span>
						</li>
						<li class="mdl-list__item">
							<span class="mdl-list__item-primary-content">
								<i class="material-icons mdl-list__item-icon">person</i>
								Phram Patherson
							</span>
						</li>
						<li class="mdl-list__item">
							<span class="mdl-list__item-primary-content">
								<i class="material-icons mdl-list__item-icon">person</i>
								Kitrati Karnkung
							</span>
						</li>
					</ul>
				</div>
			</div>
			<div class="mdl-cell mdl-cell--8-col mdl-cell--6-col-tablet chat-zone mdl-shadow--2dp">
				<div id="chat-area" class="chat-area">
					<div class="message-system">ยินดีต้อนรับเข้าสู่หน้าแชท</div>
					<div class="message-me">สวัสดี</div>
					<div class="message-other"><a>Test : </a> เช่นกัน</div>
					<div class="message-me">สวัสดี~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</div>
					<div class="message-other"><a>Test : </a> เช่นกัน</div>
					<div class="message-me">สวัสดี</div>
					<div class="message-other"><a>Test : </a> เช่นกันนนนนนนนนนนนนนนนนนนนนนนนนนนนนนนนน</div>
					<div class="message-me">สวัสดี</div>
					<div class="message-other"><a>Test : </a> เช่นกัน</div>
					<div class="message-me">สวัสดี</div>
					<div class="message-other"><a>Test : </a> เช่นกัน</div>
					<div class="message-me">สวัสดี</div>
					<div class="message-other"><a>Test : </a> เช่นกัน</div>
					<div class="message-me">สวัสดี</div>
					<div class="message-other"><a>Test : </a> เช่นกัน</div>
					<div class="message-me">สวัสดี</div>
					<div class="message-other"><a>Test : </a> เช่นกัน</div>
				</div>
				<div class="messagebox">
					<button id="send-message" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored sending" disabled>Send</button>
					<form>
						<input id="input-message" class="mdl-textfield__input textbox" type="text"  disabled>
					</form>
				</div>
			</div>
		</div>
	</div>
	</main>
</div>
<script>
	$(document).ready(function() {
		//////  Set NETPIE  /////
		const APPID = "APPID";
		const APPKEY = "APPKEY";
		const APPSECRET = "APPSECRET";

		// Create Microgear Object //
		var microgear = Microgear.create({
			gearkey: APPKEY,
			gearsecret: APPSECRET
		});

		microgear.on('connected', function() {
			microgear.subscribe('/chat');
			microgear.setname(name);
			connect_button();
			console.log('microgear connect');
		});

		microgear.on('disconnected', function() {
			disconnect_button();
			console.log('disconnect');
		});

		microgear.on('rejected', function(info) {
			disconnect_button();
			console.log('Connection rejected: '+ info);
		});

		microgear.on('error', function(err) {
			disconnect_button();
			console.log('Error: '+ err);
		});

		function connect_button() {
			// style button for connected status
			$('#connect').prop('disabled', false);
			$('#connect').removeClass('mdl-button--colored');
			$('#connect').addClass('mdl-button--accent');
			$('#connect').text('disconnect');

			$('#input-message').prop('disabled', false);
			$('#send-message').prop('disabled', false);
		}

		function connecting_button() {
			// style button for connecting status
			$('#name').prop('disabled', true);
			$('#connect').prop('disabled', true);
			$('#connect').text('connecting...');
		}

		function disconnect_button() {
			// style button for disconnect status
			$('#name').prop('disabled', false);
			$('#connect').prop('disabled', false);
			$('#connect').removeClass('mdl-button--accent');
			$('#connect').addClass('mdl-button--colored');
			$('#connect').text('connect');

			$('#input-message').prop('disabled', true);
			$('#send-message').prop('disabled', true);
		}

	    $('#main').fadeIn('slow');

		$('#connect').click(function() {
			if($('#name').val() != "") {
				if($('#connect').text() == 'connect') {
					connecting_button();
					microgear.connect(APPID); // Connect microgear
				}
				else if($('#connect').text() == 'disconnect') {
					microgear.unsubscribe('/chat');
					microgear.client.disconnect();
					microgear.client = null;
				}
			}
			else alert("Please enter your name.");
		});

		$('#name').keypress(function (e) {
			if(e.which == 13 && $('#name').val() != "") {
				connecting_button();
				microgear.connect(APPID); // Connect microgear
				return false;
			}
			else if(e.which == 13 && $('#name').val() == "") {
				alert("Please enter your name.");
				return false;
			}
		});

		$(window).unload(function() {
		  microgear.publish("/chat","bye#"+name);
		});
	});
</script>
</body>
</html>